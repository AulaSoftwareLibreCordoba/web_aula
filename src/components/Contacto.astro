---
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import { faMailReply } from "@fortawesome/free-solid-svg-icons";

const apiUrl = import.meta.env.ENDPOINT_MAILS;
---

<section class="bg-gradient-to-b from-[#0a0a2a] via-[#0d0d43] to-transparent relative pb-[4.6rem] md:pb-20">
  <div class="container mx-auto px-4 md:px-6 lg:px-8">
    <div class="flex flex-col lg:flex-row items-center lg:items-start justify-center lg:gap-12 xl:gap-20">
      <div class="w-full md:w-1/3 max-w-md mt-16 text-center md:text-left">
        <h1 class="text-white text-4xl md:text-5xl font-bold flex items-center justify-center lg:justify-start gap-5">
          Contacto <FontAwesomeIcon icon={faMailReply} className="text-blue-600 size-8" />
        </h1>
        <span class="text-slate-400 text-sm text-center">
          Contacta con nosotros para más información y unirte a nuestra
          maravillosa comunidad.
        </span>
      </div>

      <form
        id="contacto"
        class="w-full md:w-2/3 max-w-lg mt-16"
      >
        <div class="relative mb-6">
          <input
            type="text"
            name="subject"
            class="peer block min-h-[auto] w-full rounded border-b-2 border-slate-400 bg-transparent px-3 py-[0.32rem] leading-[2.15] outline-none transition-all duration-200 ease-linear focus:border-b-2 focus:border-blue-600 text-white placeholder:text-neutral-500"
            id="asunto"
            placeholder="Introduce tu nombre o tu correo electrónico"
            required
          />
        </div>
        <div class="relative mb-6">
          <textarea
            name="message"
            class="peer block min-h-[auto] w-full rounded border-b-2 border-slate-400 bg-transparent px-3 py-[0.32rem] leading-[2.15] outline-none transition-all duration-200 ease-linear focus:border-b-2 focus:border-blue-600 text-white placeholder:text-neutral-500 resize-none overflow-hidden"
            id="mensaje"
            placeholder="Mensaje"
            required
            maxlength="400"
            rows="1"
            oninput="this.style.height = 'auto'; this.style.height = (this.scrollHeight) + 'px';"
          ></textarea>
        </div>
        <div class="mt-4 text-center lg:text-right">
          <button
            type="submit"
            class="cursor-pointer w-auto inline-flex items-center justify-center py-3 px-6 text-base font-semibold text-center text-white rounded-full bg-blue-600 shadow-xs hover:bg-blue-800 hover:scale-105 transition-all duration-500"
            >Enviar</button
          >
        </div>
      </form>

    </div>
  </div>
  <div class="absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-b from-transparent via-[rgba(13,13,67,0.5)] to-[#0d0d43]"></div>
</section>

<script define:vars={{ apiUrl }}>
  const formulario = document.getElementById('contacto');

  if (formulario) {
    formulario.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(formulario);
      const toUser = "auladesoftwarelibre@gmail.com";
      const subject = "From: " + formData.get('subject');
      const message = formData.get('message');

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            toUser: [toUser],
            subject,
            message
          })
        });

        if (response.ok) {
          alert('Mensaje enviado con éxito');
          formulario.reset();
        } else {
          throw new Error('Error al enviar el mensaje');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Hubo un error al enviar el mensaje. Por favor, inténtalo de nuevo.');
      }
    });
  } else {
    console.error('El formulario no se encontró en el DOM');
  }
</script>
